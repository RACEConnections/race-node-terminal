<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SACIPHUB | Terminal v7.5 Gold</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Inter:wght@900&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Space Mono', monospace; background-color: #000; color: #4ade80; overflow-x: hidden; }
        .hidden { display: none !important; }
        .terminal-glow { box-shadow: 0 0 30px rgba(74, 222, 128, 0.15); border: 1px solid rgba(74, 222, 128, 0.3); }
        .glitch-text:hover { text-shadow: 2px 0 #ff0000, -2px 0 #00ff00; cursor: help; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: #15803d; border-radius: 4px; }
    </style>
</head>
<body class="p-4 md:p-8 min-h-screen flex flex-col">

    <div id="unlock-gate" class="fixed inset-0 z-[2000] bg-black flex items-center justify-center p-6">
        <div class="max-w-md w-full p-8 bg-black terminal-glow text-center rounded-lg relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-1 bg-green-500 animate-pulse"></div>
            <h2 class="text-green-500 font-black text-xs uppercase tracking-[0.5em] mb-8">System_Lock_Active</h2>
            
            <div class="space-y-6">
                <input id="launch-key-input" type="password" placeholder="ENTER_GENESIS_KEY" class="w-full bg-black border border-green-900 p-4 text-green-500 text-center outline-none focus:border-green-500 font-mono transition-colors placeholder-green-900">
                <button onclick="attemptLaunch()" class="w-full bg-green-900/10 border border-green-500 text-green-500 py-4 font-black text-[10px] hover:bg-green-500 hover:text-black uppercase tracking-[0.3em] transition-all duration-300">Initiate_Uplink</button>
            </div>
            
            <div class="mt-8 pt-6 border-t border-green-900/30 flex justify-between items-center text-[7px] text-green-800 uppercase">
                <span>Phase: Global_Establishment</span>
                <span>Day 001 / 180</span>
            </div>
        </div>
    </div>

    <div id="terminal-content" class="max-w-5xl mx-auto opacity-0 pointer-events-none transition-opacity duration-1000 flex-1">
        
        <header class="flex flex-col md:flex-row justify-between items-end mb-16 border-b border-green-900/30 pb-6">
            <div>
                <h1 class="text-5xl md:text-7xl font-black text-white italic tracking-tighter glitch-text" style="font-family: 'Inter', sans-serif;">SACIPHUB</h1>
                <p class="text-[9px] tracking-[0.6em] text-green-600 uppercase mt-2">R.A.C.E. Operational Terminal // v7.5</p>
            </div>
            <div class="flex flex-col items-end gap-2 mt-6 md:mt-0">
                <div class="flex items-center gap-2">
                    <div class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></div>
                    <span class="text-[8px] text-green-500 uppercase">System_Online</span>
                </div>
                <button id="connect-wallet" onclick="connectWallet()" class="border border-green-500 px-6 py-2 text-[10px] font-bold hover:bg-green-500 hover:text-black uppercase transition-all">Connect_Wallet</button>
            </div>
        </header>

        <section class="mb-16 p-8 bg-green-950/10 rounded-xl terminal-glow text-center relative overflow-hidden">
            <div class="absolute top-0 right-0 p-4 opacity-20"><svg class="w-24 h-24 text-green-500" fill="currentColor" viewBox="0 0 20 20"><path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z" /><path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z" clip-rule="evenodd" /></svg></div>
            
            <h3 class="text-[10px] text-green-400 font-black uppercase mb-6 tracking-[0.4em]">Establishment_Stability_Protocol</h3>
            
            <div class="inline-block border-2 border-green-500/30 p-6 rounded-lg bg-black mb-8">
                <p class="text-[9px] text-gray-500 uppercase mb-2">Current_Stability_Clock</p>
                <div id="stability-timer" class="text-6xl md:text-7xl font-black text-white glitch-text">DAY_001 <span class="text-lg text-green-700 font-normal">/ 180</span></div>
            </div>

            <div class="flex justify-center">
                <button onclick="generateCertificate()" class="group relative px-8 py-3 bg-white text-black text-[10px] font-black uppercase overflow-hidden hover:bg-green-400 transition-all">
                    <span class="relative z-10 flex items-center gap-2">
                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                        Download_Official_Certificate
                    </span>
                </button>
            </div>
            <p class="text-[8px] text-green-800 mt-6 uppercase italic tracking-wider">Target: August 6, 2026 // Uninterrupted_Status: CONFIRMED</p>
        </section>

        <section id="founder-panel" class="hidden mb-16 border border-red-900/50 p-6 bg-red-950/10 rounded-lg relative">
            <div class="absolute -top-3 left-6 bg-black px-2 text-[9px] text-red-500 font-bold uppercase tracking-widest border border-red-900">Founder_Command_Center</div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div>
                    <label class="text-[8px] text-red-400 uppercase block mb-2">Emergency_Rate_Override (NGN)</label>
                    <div class="flex gap-2">
                        <input id="manual-rate-input" type="number" placeholder="Set Rate (e.g. 1500)" class="w-full bg-black border border-red-900/50 p-2 text-red-500 text-xs outline-none focus:border-red-500">
                        <button onclick="saveManualRate()" class="bg-red-900/20 text-red-500 px-4 py-2 text-[9px] font-bold uppercase border border-red-900 hover:bg-red-900 hover:text-white transition-all">Execute</button>
                    </div>
                    <p class="text-[7px] text-red-800 mt-1">*Set to 0 to resume Live API</p>
                </div>

                <div class="flex items-center justify-between border-l border-red-900/30 pl-8">
                    <div>
                        <h4 class="text-[9px] text-red-400 uppercase mb-1">Broadcast_Uplink</h4>
                        <div class="flex items-center gap-2">
                            <div class="w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse"></div>
                            <span class="text-[8px] text-gray-400">Telegram &rarr; WhatsApp Bridge: <span class="text-white font-bold">ACTIVE</span></span>
                        </div>
                    </div>
                    <div class="text-[7px] text-gray-600 text-right">
                        UID: 8096...e988<br>Verified
                    </div>
                </div>
            </div>
        </section>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-20">
            <div class="border border-yellow-900/30 p-8 bg-black rounded-xl relative group hover:border-yellow-600/50 transition-colors">
                <div class="absolute top-0 right-0 p-4 text-yellow-900/20 group-hover:text-yellow-600/20 transition-colors text-6xl font-black italic select-none">$</div>
                <h3 class="text-yellow-500 font-bold text-[10px] uppercase mb-6 tracking-widest">Asset_Staking_Vault</h3>
                
                <div class="space-y-6">
                    <div>
                        <label class="text-[8px] text-gray-500 uppercase block mb-2">Token_Amount ($SHUB)</label>
                        <input id="stake-input" type="number" oninput="calculateRewards()" placeholder="0.00" class="w-full bg-black border-b border-yellow-900 p-2 text-2xl text-yellow-500 outline-none focus:border-yellow-500 font-mono placeholder-yellow-900/50">
                    </div>
                    
                    <div class="flex items-center justify-between text-[9px] text-gray-400 border-t border-yellow-900/20 pt-4">
                        <span>APY Protocol:</span>
                        <span class="text-yellow-500 font-bold">120% (10% Monthly)</span>
                    </div>
                </div>
            </div>
            
            <div class="p-8 border border-green-900/20 rounded-xl bg-green-950/5 flex flex-col justify-center">
                <p class="text-[8px] text-green-800 uppercase mb-4 tracking-widest">Projected_Monthly_Yield</p>
                
                <div class="mb-6">
                    <div id="reward-tokens" class="text-4xl md:text-5xl font-black text-white mb-2">0.00 <span class="text-lg text-green-600">$SHUB</span></div>
                    <div class="h-1 w-12 bg-green-600 rounded"></div>
                </div>

                <div class="space-y-2 font-mono">
                    <div class="flex justify-between items-center text-sm">
                        <span class="text-gray-500">USD Value</span>
                        <span id="val-usd" class="text-white font-bold">$0.00</span>
                    </div>
                    <div class="flex justify-between items-center text-sm">
                        <span class="text-gray-500">NGN Value</span>
                        <span id="val-ngn" class="text-green-400 font-bold">â‚¦0.00</span>
                    </div>
                </div>
                <p class="text-[7px] text-gray-600 mt-6 text-right uppercase">Live Rate: â‚¦<span id="live-rate-display">--</span> / USD</p>
            </div>
        </div>

        <footer class="text-center border-t border-green-900/30 pt-12 pb-12">
            <div class="mb-8">
                <button onclick="toggleTerms()" class="text-[9px] text-gray-600 uppercase tracking-[0.4em] hover:text-green-500 transition-colors">Institutional_Terms_of_Service</button>
            </div>
            <p class="text-[8px] text-green-900 uppercase">SACIPHUB Global Online Establishment &copy; 2026</p>
            <p class="text-[7px] text-green-950 mt-2">System_ID: lieuqcbkoltrfqrtryjb</p>
        </footer>

    </div>

    <div id="terms-modal" class="hidden fixed inset-0 z-[3000] bg-black/95 backdrop-blur-sm flex items-center justify-center p-6">
        <div class="max-w-2xl w-full border border-green-500 bg-black p-8 relative overflow-y-auto max-h-[80vh]">
            <button onclick="toggleTerms()" class="absolute top-6 right-6 text-green-500 font-bold hover:text-white text-[10px] uppercase">Close_Protocol</button>
            <h2 class="text-xl font-black text-white uppercase mb-8 border-b border-green-900 pb-4">Terms_of_Establishment</h2>
            <div class="space-y-6 text-[10px] text-gray-400 font-mono leading-relaxed">
                <p><strong class="text-green-500">01. STABILITY RULE:</strong> Physical operations in Osogbo commence strictly 180 days after global online establishment reaches uninterrupted stability.</p>
                <p><strong class="text-green-500">02. RESET CLAUSE:</strong> Any technical interruption to the terminal or database uplink resets the 180-day countdown to zero immediately.</p>
                <p><strong class="text-green-500">03. FINANCIAL DATA:</strong> $SHUB and $OMNIF are trading digital assets. NGN/USD values are live estimates and not guaranteed.</p>
            </div>
            <div class="mt-8 pt-4 border-t border-green-900 text-[8px] text-green-800 text-center uppercase">Founder Authorized Directive // 2026</div>
        </div>
    </div>

    <canvas id="certCanvas" width="800" height="600" class="hidden"></canvas>

    <script>
        // --- CONFIGURATION ---
        const SUPABASE_URL = 'https://lieuqcbkoltrfqrtryjb.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxpZXVxY2Jrb2x0cmZxcnRyeWpiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAzNjA3ODgsImV4cCI6MjA4NTkzNjc4OH0.zsZLEHQOsQZPxn18lda83F6_8NBsn53ZQ_WC6iR0jfU';
        const _supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        let TG_TOKEN = "";
        let TG_CHAT = "";
        let GENESIS = "";
        let currentNgnRate = 1362.00; // Fallback
        const STABILITY_START_DATE = new Date("2026-02-07T00:00:00");

        // --- INITIALIZATION ---
        async function initSystem() {
            try {
                // Fetch Config from Supabase
                const { data, error } = await _supabase.from('app_config').select('key, value');
                
                if (data) {
                    data.forEach(item => {
                        if(item.key === 'tg_bot_token') TG_TOKEN = item.value;
                        if(item.key === 'tg_chat_id') TG_CHAT = item.value;
                        if(item.key === 'genesis_key') GENESIS = item.value;
                        if(item.key === 'manual_ngn_rate' && parseFloat(item.value) > 0) {
                            currentNgnRate = parseFloat(item.value);
                            console.log("MANUAL_RATE_ACTIVE");
                        }
                    });
                }

                // If no manual rate, fetch live API
                if (!data || !data.find(i => i.key === 'manual_ngn_rate' && parseFloat(i.value) > 0)) {
                    await fetchLiveRate();
                }

                checkAdminStatus();
                updateTimerDisplay();
                document.getElementById('live-rate-display').innerText = currentNgnRate.toLocaleString();
                
            } catch (e) {
                console.error("SYSTEM_INIT_FAILURE", e);
            }
        }

        async function fetchLiveRate() {
            try {
                const res = await fetch('https://open.er-api.com/v6/latest/USD');
                const data = await res.json();
                if(data && data.rates && data.rates.NGN) {
                    currentNgnRate = data.rates.NGN;
                }
            } catch(e) { console.warn("API_DOWN_USING_FALLBACK"); }
        }

        // --- CORE FUNCTIONS ---
        
        async function sendAlert(msg) {
            if(!TG_TOKEN || !TG_CHAT) return;
            const url = `https://api.telegram.org/bot${TG_TOKEN}/sendMessage?chat_id=${TG_CHAT}&text=${encodeURIComponent(msg)}`;
            fetch(url).catch(e => console.error("TELEGRAM_UPLINK_FAIL"));
        }

        async function connectWallet() {
            if (window.ethereum) {
                try {
                    const acc = await window.ethereum.request({ method: 'eth_requestAccounts' });
                    document.getElementById('connect-wallet').innerText = acc[0].substring(0,8) + "...";
                    document.getElementById('connect-wallet').classList.add('bg-green-500', 'text-black');
                    
                    sendAlert(`ðŸ”Œ NEW OPERATIVE CONNECTED\nWallet: ${acc[0]}\nTime: ${new Date().toLocaleString()}`);
                    
                    confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 }, colors: ['#4ade80', '#ffffff'] });
                } catch (e) { console.error("WALLET_CONNECT_FAIL"); }
            } else {
                alert("WEB3_WALLET_NOT_DETECTED");
            }
        }

        function calculateRewards() {
            const stake = parseFloat(document.getElementById('stake-input').value) || 0;
            const monthlyTokens = stake * 0.10;
            const monthlyUSD = monthlyTokens * 0.01; // Base internal peg $0.01
            const monthlyNGN = monthlyUSD * currentNgnRate;
            
            document.getElementById('reward-tokens').innerText = `${monthlyTokens.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})} $SHUB`;
            document.getElementById('val-usd').innerText = `$${monthlyUSD.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})} USD`;
            document.getElementById('val-ngn').innerText = `â‚¦${monthlyNGN.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})} NGN`;
        }

        function generateCertificate() {
            const canvas = document.getElementById('certCanvas');
            const ctx = canvas.getContext('2d');
            
            // BG
            ctx.fillStyle = '#050505'; ctx.fillRect(0,0,800,600);
            
            // Border
            ctx.strokeStyle = '#4ade80'; ctx.lineWidth = 15; ctx.strokeRect(20,20,760,560);
            ctx.strokeStyle = '#14532d'; ctx.lineWidth = 2; ctx.strokeRect(40,40,720,520);

            // Header
            ctx.fillStyle = '#ffffff'; ctx.font = '900 45px Inter'; ctx.textAlign = "center";
            ctx.fillText('STABILITY CERTIFICATE', 400, 120);
            
            // Status
            ctx.fillStyle = '#4ade80'; ctx.font = 'bold 30px Space Mono'; 
            ctx.fillText(`STATUS: DAY 001 / 180`, 400, 200);
            
            // Details
            ctx.fillStyle = '#9ca3af'; ctx.font = '16px Space Mono'; ctx.textAlign = "left";
            ctx.fillText('PROJECT: SACIPHUB GLOBAL ESTABLISHMENT', 180, 320);
            ctx.fillText('FOUNDER: ADEOTI OLUFOLAMI ADELEYE', 180, 360);
            ctx.fillText(`DATE: ${new Date().toLocaleDateString()}`, 180, 400);

            // Stamp
            ctx.strokeStyle = '#ffffff'; ctx.lineWidth = 4; ctx.strokeRect(250, 480, 300, 60);
            ctx.fillStyle = '#ffffff'; ctx.font = 'bold 20px Inter'; ctx.textAlign = "center";
            ctx.fillText('UNINTERRUPTED CONFIRMED', 400, 517);

            // Download
            const link = document.createElement('a');
            link.download = 'SACIPHUB_STABILITY_DAY1.png';
            link.href = canvas.toDataURL();
            link.click();
        }

        async function checkAdminStatus() {
            const { data: { user } } = await _supabase.auth.getUser();
            // UID Verification: 8096de6f-d0f5-447b-ba3b-aafbd487e988
            if (user?.id === '8096de6f-d0f5-447b-ba3b-aafbd487e988') {
                document.getElementById('founder-panel').classList.remove('hidden');
                document.getElementById('manual-rate-input').value = currentNgnRate;
            }
        }

        async function saveManualRate() {
            const newRate = document.getElementById('manual-rate-input').value;
            const { error } = await _supabase.from('app_config').update({ value: newRate.toString() }).eq('key', 'manual_ngn_rate');
            if (!error) {
                alert("SYSTEM_OVERRIDE_SUCCESSFUL");
                location.reload();
            } else { alert("ACCESS_DENIED: FOUNDER ONLY"); }
        }

        function attemptLaunch() {
            const input = document.getElementById('launch-key-input').value;
            if (input === GENESIS) {
                document.getElementById('unlock-gate').classList.add('hidden');
                document.getElementById('terminal-content').classList.remove('opacity-0', 'pointer-events-none');
                document.getElementById('terminal-content').classList.add('opacity-100', 'pointer-events-auto');
                
                // Trigger confetti on unlock
                confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
            } else {
                alert("ACCESS_DENIED: INVALID GENESIS KEY");
            }
        }

        function updateTimerDisplay() {
            // Simple visual placeholder since Day 1 is hardcoded for the cert launch
            // In a real countdown, you'd calculate Date.now() - STABILITY_START_DATE
        }

        function toggleTerms() {
            const modal = document.getElementById('terms-modal');
            modal.classList.toggle('hidden');
        }

        window.onload = initSystem;
    </script>
</body>
</html>
