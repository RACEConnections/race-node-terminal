<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OMNIF R.A.C.E. Terminal v4.1</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module">
        import { createThirdwebClient, getContract, prepareContractCall, sendTransaction, readContract, defineChain } from "https://esm.sh/thirdweb";

        // 1. PROTOCOL CONFIGURATION
        const CONFIG = {
            CLIENT_ID: "763f242f0eaafeb788a2e494c956f183",
            OMNIF: "0xc23F43FE5D5D65b0a094c8A8A712aBd4e820A210",
            SHUB: "0x2Ab76FC9f98434E119A16c9634cD9eFd2B92C77C",
            CHAIN: defineChain(1116) // Core DAO Mainnet
        };

        const client = createThirdwebClient({ clientId: CONFIG.CLIENT_ID });

        // 2. DUAL-TOKEN SYNC LOGIC
        async function syncBalances() {
            if (!window.userAddress) return;
            try {
                const omnif = getContract({ client, address: CONFIG.OMNIF, chain: CONFIG.CHAIN });
                const shub = getContract({ client, address: CONFIG.SHUB, chain: CONFIG.CHAIN });

                const [balO, balS] = await Promise.all([
                    readContract({ contract: omnif, method: "function balanceOf(address)", params: [window.userAddress] }),
                    readContract({ contract: shub, method: "function balanceOf(address)", params: [window.userAddress] })
                ]);

                // Formatting balances (assuming 18 decimals)
                document.getElementById('omnif-bal').innerText = (Number(balO)/1e18).toLocaleString(undefined, {minimumFractionDigits: 2}) + " OMNF";
                document.getElementById('shub-bal').innerText = (Number(balS)/1e18).toLocaleString(undefined, {minimumFractionDigits: 2}) + " SHUB";
                document.getElementById('status').innerText = "NODE SYNCHRONIZED";
            } catch (err) {
                console.error("Sync Error:", err);
                document.getElementById('status').innerText = "SYNC ERROR: CHECK CONNECTION";
            }
        }

        // 3. THE ANCHOR & MINT PROTOCOL
        window.executeMint = async function(tokenAddress, label) {
            if (!window.userAddress) return alert("Connect Wallet First!");
            try {
                const status = document.getElementById('status');
                status.innerText = `MINTING ${label}...`;
                
                const contract = getContract({ client, address: tokenAddress, chain: CONFIG.CHAIN });

                const transaction = prepareContractCall({
                    contract,
                    method: "function mint(address to, uint256 amount)",
                    params: [window.userAddress, BigInt(1000000 * 10**18)] // Mints 1 Million
                });

                const { transactionHash } = await sendTransaction({
                    transaction,
                    account: window.activeAccount
                });

                status.innerText = "SUCCESS: " + transactionHash.slice(0,10);
                setTimeout(syncBalances, 3000); // Auto-refresh after 3 seconds
            } catch (err) {
                status.innerText = "FAILED: NOT OWNER OR NO GAS";
                alert(err.message);
            }
        };

        // 4. WALLET INITIALIZATION
        window.connect = async function() {
            if (!window.ethereum) return alert("Please open in MetaMask Browser");
            try {
                const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                window.userAddress = accounts[0];
                window.activeAccount = { address: accounts[0] };
                
                document.getElementById('btn-connect').classList.add('hidden');
                document.getElementById('node-ui').classList.remove('hidden');
                document.getElementById('wallet-addr').innerText = window.userAddress.slice(0,6) + "..." + window.userAddress.slice(-4);
                
                syncBalances();
                setInterval(syncBalances, 10000); // Auto-refresh every 10 seconds
            } catch (err) {
                alert("Connection Failed");
            }
        };
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Mono&display=swap');
        body { font-family: 'Space Mono', monospace; background-color: #0a0a0a; color: #00ff00; }
        .terminal-box { border: 1px solid #00ff00; box-shadow: 0 0 20px rgba(0, 255, 0, 0.2); }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <div class="terminal-box w-full max-w-md bg-black p-6 rounded-lg">
        <header class="mb-6 border-b border-green-900 pb-4">
            <h1 class="text-xl font-bold tracking-tighter">R.A.C.E. TERMINAL V4.1</h1>
            <p class="text-xs text-green-700">OLUFOLAMI_ADEOTI_CONNECT</p>
        </header>

        <button id="btn-connect" onclick="connect()" class="w-full bg-green-600 text-black py-3 font-bold hover:bg-green-400 transition-all uppercase">
            Initialize Connection
        </button>

        <div id="node-ui" class="hidden space-y-6">
            <div class="flex justify-between text-xs mb-4">
                <span class="text-green-800">ACTIVE_NODE:</span>
                <span id
